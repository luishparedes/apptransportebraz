<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSPORTE BRAZ</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>TRANSPORTE BRAZ</h1>
    <div id="mensaje-edicion" style="display: none;">Est치s editando un viaje</div>

    <form id="vehiculoForm">
        <label for="fecha">Fecha:</label><input type="date" id="fecha" required><br><br>
        <label for="empresa">Empresa:</label><input type="text" id="empresa" required><br><br>
        <label for="chofer">Chofer:</label><input type="text" id="chofer" required><br><br>
        <label for="placa">Placa:</label><input type="text" id="placa" required><br><br>
        <label for="salida">Salida:</label><input type="text" id="salida" required><br><br>
        <label for="destino">Destino:</label><input type="text" id="destino" required><br><br>
        <label for="viaticos">Vi치ticos (USD):</label><input type="number" id="viaticos" required><br><br>
        <label for="gasoil">Gasoil (USD):</label><input type="number" id="gasoil" required><br><br>
        <label for="litrosGasoil">Litros Gasoil:</label><input type="number" id="litrosGasoil" required><br><br>
        <label for="gastos">Gastos (USD):</label><input type="number" id="gastos" required><br><br>
        <label for="pago">Pago Chofer (USD):</label><input type="number" id="pago" required><br><br>
        <label for="entrada">Entrada (USD):</label><input type="number" id="entrada" required><br><br>
        <label for="estadoPago">Estado Pago:</label>
        <select id="estadoPago" required>
            <option value="Pagado">Pagado</option>
            <option value="Falta por cobrar">Falta por cobrar</option>
        </select><br><br>
        <button type="submit">Agregar Viaje</button>
    </form>

    <h2>Reporte de Viajes</h2>
    <div id="reporte"></div>

    <script>
        document.addEventListener('DOMContentLoaded', cargarDatos);
        let viajes = JSON.parse(localStorage.getItem('viajes')) || [];
        let editing = false;
        let viajeEditando = null;

        document.getElementById('vehiculoForm').addEventListener('submit', function(event) {
            event.preventDefault();
            if (editing) guardarCambios(); else agregarViaje();
        });

        function agregarViaje() {
            const nuevoViaje = {
                fecha: document.getElementById('fecha').value,
                empresa: document.getElementById('empresa').value,
                chofer: document.getElementById('chofer').value,
                placa: document.getElementById('placa').value,
                salida: document.getElementById('salida').value,
                destino: document.getElementById('destino').value,
                viaticos: parseFloat(document.getElementById('viaticos').value),
                gasoil: parseFloat(document.getElementById('gasoil').value),
                litrosGasoil: parseFloat(document.getElementById('litrosGasoil').value),
                gastos: parseFloat(document.getElementById('gastos').value),
                pago: parseFloat(document.getElementById('pago').value),
                entrada: parseFloat(document.getElementById('entrada').value),
                estadoPago: document.getElementById('estadoPago').value,
                gananciasNetas: parseFloat(document.getElementById('entrada').value) -
                    parseFloat(document.getElementById('viaticos').value) -
                    parseFloat(document.getElementById('gasoil').value) -
                    parseFloat(document.getElementById('gastos').value) -
                    parseFloat(document.getElementById('pago').value)
            };
            viajes.push(nuevoViaje);
            guardarDatos();
            mostrarReporte();
            document.getElementById('vehiculoForm').reset();
        }

        function editarViaje(index) {
            editing = true;
            viajeEditando = viajes[index];
            document.getElementById('fecha').value = viajeEditando.fecha;
            document.getElementById('empresa').value = viajeEditando.empresa;
            document.getElementById('chofer').value = viajeEditando.chofer;
            document.getElementById('placa').value = viajeEditando.placa;
            document.getElementById('salida').value = viajeEditando.salida;
            document.getElementById('destino').value = viajeEditando.destino;
            document.getElementById('viaticos').value = viajeEditando.viaticos;
            document.getElementById('gasoil').value = viajeEditando.gasoil;
            document.getElementById('litrosGasoil').value = viajeEditando.litrosGasoil;
            document.getElementById('gastos').value = viajeEditando.gastos;
            document.getElementById('pago').value = viajeEditando.pago;
            document.getElementById('entrada').value = viajeEditando.entrada;
            document.getElementById('estadoPago').value = viajeEditando.estadoPago;
            viajes.splice(index, 1);
            guardarDatos();
            mostrarReporte();
            document.getElementById('mensaje-edicion').style.display = 'block';
            document.querySelector('button[type="submit"]').textContent = 'Guardar Cambios';
        }

        function guardarCambios() {
            viajeEditando.fecha = document.getElementById('fecha').value;
            viajeEditando.empresa = document.getElementById('empresa').value;
            viajeEditando.chofer = document.getElementById('chofer').value;
            viajeEditando.placa = document.getElementById('placa').value;
            viajeEditando.salida = document.getElementById('salida').value;
            viajeEditando.destino = document.getElementById('destino').value;
            viajeEditando.viaticos = parseFloat(document.getElementById('viaticos').value);
            viajeEditando.gasoil = parseFloat(document.getElementById('gasoil').value);
            viajeEditando.litrosGasoil = parseFloat(document.getElementById('litrosGasoil').value);
            viajeEditando.gastos = parseFloat(document.getElementById('gastos').value);
            viajeEditando.pago = parseFloat(document.getElementById('pago').value);
            viajeEditando.entrada = parseFloat(document.getElementById('entrada').value);
            viajeEditando.estadoPago = document.getElementById('estadoPago').value;
            viajes.push(viajeEditando);
            guardarDatos();
            mostrarReporte();
            document.getElementById('vehiculoForm').reset();
            editing = false;
            viajeEditando = null;
            document.getElementById('mensaje-edicion').style.display = 'none';
            document.querySelector('button[type="submit"]').textContent = 'Agregar Viaje';
        }

        function eliminarViaje(index) {
            viajes.splice(index, 1);
            guardarDatos();
            mostrarReporte();
        }

        function mostrarReporte() {
            const reporteDiv = document.getElementById('reporte');
            reporteDiv.innerHTML = '';
            viajes.forEach((viaje, index) => {
                const viajeReporte = document.createElement('div');
                viajeReporte.innerHTML = `
                    <h3>Viaje #${index + 1}</h3>
                    <p><strong>Fecha:</strong> ${viaje.fecha}</p>
                    <p><strong>Empresa:</strong> ${viaje.empresa}</p>
                    <p><strong>Chofer:</strong> ${viaje.chofer}</p>
                    <p><strong>Placa:</strong> ${viaje.placa}</p>
                    <p><strong>Salida:</strong> ${viaje.salida}</p>
                    <p><strong>Destino:</strong> ${viaje.destino}</p>
                    <p><strong>Vi치ticos (USD):</strong> ${viaje.viaticos}</p>
                    <p><strong>Gasoil (USD):</strong> ${viaje.gasoil}</p>
                    <p><strong>Litros Gasoil:</strong> ${viaje.litrosGasoil}</p>
                    <p><strong>Gastos (USD):</strong> ${viaje.gastos}</p>
                    <p><strong>Pago Chofer (USD):</strong> ${viaje.pago}</p>
                    <p><strong>Entrada (USD):</strong> ${viaje.entrada}</p>
                    <p><strong>Ganancias Netas (USD):</strong> ${viaje.gananciasNetas}</p>
                    <p class="${viaje.estadoPago === 'Falta por cobrar' ? 'falta-cobrar' : 'pagado'}"><strong>Estado Pago:</strong> ${viaje.estadoPago}</p>
                    <button onclick="editarViaje(${index})">Editar</button>
                    <button onclick="eliminarViaje(${index})">Eliminar</button>
                    <button onclick="generarPDF(${index})">Generar PDF</button>
                    <hr>
                `;
                reporteDiv.appendChild(viajeReporte);
            });
        }

        function generarPDF(index) {
            const viaje = viajes[index];
            const doc = new jspdf.jsPDF();
            doc.setFontSize(18);
            doc.text("Ficha de Viaje", 10, 10);
            doc.setFontSize(12);
            let y = 20;
            const agregarTexto = (texto) => { doc.text(texto, 10, y); y += 10; };
            agregarTexto(`Fecha: ${viaje.fecha}`);
            agregarTexto(`Empresa: ${viaje.empresa}`);
            agregarTexto(`Chofer: ${viaje.chofer}`);
            agregarTexto(`Placa: ${viaje.placa}`);
            agregarTexto(`Salida: ${viaje.salida}`);
            agregarTexto(`Destino: ${viaje.destino}`);
            agregarTexto(`Vi치ticos (USD): ${viaje.viaticos}`);
            agregarTexto(`Gasoil (USD): ${viaje.gasoil}`);
            agregarTexto(`Litros Gasoil: ${viaje.litrosGasoil}`);
            agregarTexto(`Gastos (USD): ${viaje.gastos}`);
            agregarTexto(`Pago Chofer (USD): ${viaje.pago}`);
            agregarTexto(`Entrada (USD): ${viaje.entrada}`);
            agregarTexto(`Ganancias Netas (USD): ${viaje.gananciasNetas}`);
            agregarTexto(`Estado Pago: ${viaje.estadoPago}`);
            doc.save(`viaje_${index + 1}.pdf`);
        }

        function guardarDatos() {
            localStorage.setItem('viajes', JSON.stringify(viajes));
        }

        function cargarDatos() {
            mostrarReporte();
        }
    </script>
</body>
</html>
